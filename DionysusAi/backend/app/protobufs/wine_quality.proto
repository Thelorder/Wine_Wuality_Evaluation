syntax = "proto3";

package dionysus;

// ============ COMMON MESSAGES ============

message Empty {}

message StatusResponse {
    bool success = 1;
    string status = 2;
    string message = 3;
}

// ============ SENSOR FUSION AGENT (SFA) ============

message SensorReading {
    float ph = 1;
    float tds = 2;
    string color_hex = 3;
    float temperature = 4;
    int32 wine_type = 5;  // 0=red, 1=white
}

message ProcessedFeatures {
    bool success = 1;
    map<string, float> features = 2;
    string sample_id = 3;
    string error = 4;
}

// ============ QUALITY PREDICTION AGENT (QPA) ============

message WineFeatures {
    int32 type = 1;  // 0=red, 1=white
    float fixed_acidity = 2;
    float volatile_acidity = 3;
    float citric_acid = 4;
    float residual_sugar = 5;
    float chlorides = 6;
    float free_sulfur_dioxide = 7;
    float density = 8;
    float pH = 9;
    float sulphates = 10;
    float alcohol = 11;
}

message QualityPrediction {
    bool success = 1;
    float quality_score = 2;
    string quality_category = 3;  // "Poor", "Average", "Good", "Excellent"
    float confidence = 4;
    map<string, float> probabilities = 5;
    string sample_id = 6;
    string error = 7;
}

// ============ EXPLANATION AGENT (EA) ============

message ExplanationRequest {
    WineFeatures wine_features = 1;
    QualityPrediction prediction = 2;
    string user_context = 3;  // Optional: user's experience level, preferences
}

message ExplanationResponse {
    bool success = 1;
    string technical_explanation = 2;
    string simple_explanation = 3;
    repeated string food_pairings = 4;
    repeated string improvement_suggestions = 5;
    string error = 6;
}

// ============ WINE MENTOR AGENT (WMA) ============

message ChatMessage {
    string user_id = 1;
    string message = 2;
    string context = 3;  // "education", "tasting", "pairing", "general"
}

message MentorResponse {
    bool success = 1;
    string response = 2;
    string suggested_action = 3;
    repeated string related_topics = 4;
    string error = 5;
}

// ============ SERVICES ============

service QualityPredictionService {
    rpc PredictQuality(WineFeatures) returns (QualityPrediction);
    rpc GetModelStatus(Empty) returns (StatusResponse);
}

service ExplanationService {
    rpc GenerateExplanation(ExplanationRequest) returns (ExplanationResponse);
    rpc GetFoodPairings(WineFeatures) returns (ExplanationResponse);
}

service WineMentorService {
    rpc Chat(ChatMessage) returns (MentorResponse);
    rpc GetEducationalContent(ChatMessage) returns (MentorResponse);
}

service SensorFusionService {
    rpc ProcessSensorData(SensorReading) returns (ProcessedFeatures);
    rpc CalibrateSensors(Empty) returns (StatusResponse);
}